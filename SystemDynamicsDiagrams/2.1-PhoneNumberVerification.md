```mermaid
sequenceDiagram
    %% Enhanced participant styling with icons and clear roles
    participant C as ğŸ“± Client App
    participant LB as âš–ï¸ Load Balancer
    participant API as ğŸŒ HTTP API Gateway
    participant VC as âœ… VerificationController
    participant RSC as ğŸ¯ RegistrationServiceClient
    participant CACHE as ğŸ”´ Redis Cache
    participant SMS as ğŸ“ SMS/Voice Provider

    %% Phase 1: Initial Session Creation
    rect rgba(173, 216, 230, 0.15)
        Note over C,CACHE: ğŸš€ PHASE 1: Verification Session Setup
        
        C->>+LB: ğŸ“¤ POST /v1/verification/session<br/>ğŸ“‹ {phoneNumber, pushToken, captcha}
        Note right of C: Rate Limited:<br/>5 requests/hour per IP
        
        LB->>+API: ğŸ”„ Route to verification endpoint
        API->>+VC: ğŸ¯ createSession(CreateVerificationSessionRequest)
        
        rect rgba(255, 255, 224, 0.3)
            Note over VC: Input Validation
            VC->>VC: ğŸ“‹ Validate phone number format<br/>ğŸŒ Check country code allowlist<br/>ğŸš« Validate against blocklist
        end
        
        VC->>+RSC: ğŸ”— createRegistrationSession(phoneNumber, sourceHost)
        Note right of RSC: ğŸ”Œ gRPC call to Registration Service<br/>â±ï¸ Timeout: 15s<br/>ğŸ”„ Retry: 3 attempts
        RSC-->>-VC: âœ… RegistrationServiceSession<br/>ğŸ†” {sessionId, expiration: 10min}
        
        VC->>+CACHE: ğŸ’¾ Store session metadata<br/>ğŸ”‘ Key: session:{sessionId}<br/>â° TTL: 10 minutes
        CACHE-->>-VC: âœ… Session cached successfully
        
        VC-->>-API: ğŸ“¤ VerificationSessionResponse<br/>ğŸ†” {sessionId, requestedInfo[CAPTCHA]}
        API-->>-LB: âœ… HTTP 200 OK
        LB-->>-C: ğŸ‰ Session created - Ready for verification
    end

    %% Phase 2: Code Request and Delivery
    rect rgba(255, 228, 225, 0.15)
        Note over C,CACHE: ğŸ“ PHASE 2: Verification Code Delivery
        
        C->>+LB: ğŸ“¤ PATCH /v1/verification/session/{sessionId}<br/>ğŸ“‹ {transport: "sms", captchaResponse}
        Note right of C: Transport options:<br/>ğŸ“± SMS, â˜ï¸ Voice call
        
        LB->>+API: ğŸ”„ Route code request
        API->>+VC: ğŸ”„ updateSession(sessionId, transport, captcha)
        
        rect rgba(255, 240, 245, 0.3)
            Note over VC,CACHE: Session Validation
            VC->>+CACHE: ğŸ” Validate session exists & not expired
            CACHE-->>-VC: âœ… Valid session found
            VC->>VC: ğŸ” Verify CAPTCHA response<br/>ğŸš¦ Check rate limits (1 req/min per number)
        end
        
        VC->>+RSC: ğŸ“ sendVerificationCode(sessionId, SMS, clientType)
        RSC->>+SMS: ğŸ“¤ Forward to Twilio/Voice provider
        Note right of SMS: ğŸ“± SMS: "Your Signal code: 123456"<br/>â±ï¸ Valid for: 10 minutes<br/>ğŸ”„ Max attempts: 3
        SMS-->>-RSC: âœ… Message queued for delivery
        RSC-->>-VC: ğŸ“‹ RegistrationServiceSession(verified: false, codesSent: 1)
        
        VC->>+CACHE: ğŸ”„ Update session state<br/>ğŸ“Š {codesSent++, lastCodeSent: timestamp}
        CACHE-->>-VC: âœ… Session state updated
        
        VC-->>-API: ğŸ“¤ VerificationSessionResponse<br/>ğŸ“± {transport: "sms", nextCodeIn: 60s}
        API-->>-LB: âœ… HTTP 200 OK
        LB-->>-C: ğŸ“ Verification code sent via SMS
    end

    %% Phase 3: Code Verification
    rect rgba(240, 255, 240, 0.15)
        Note over C,CACHE: âœ… PHASE 3: Code Verification
        
        C->>+LB: ğŸ“¤ PUT /v1/verification/session/{sessionId}/code<br/>ğŸ“‹ {verificationCode: "123456"}
        
        LB->>+API: ğŸ”„ Route verification
        API->>+VC: âœ… verifyCode(sessionId, code)
        
        VC->>+CACHE: ğŸ” Retrieve session data
        CACHE-->>-VC: ğŸ“‹ Session metadata
        
        VC->>+RSC: ğŸ” checkVerificationCode(sessionId, code)
        Note right of RSC: ğŸ” Validate against sent code<br/>â±ï¸ Check expiration<br/>ğŸ”¢ Max 3 attempts
        
        alt âœ… Code Valid
            RSC-->>VC: âœ… RegistrationServiceSession(verified: true)
            VC->>+CACHE: ğŸ”„ Mark session as verified<br/>ğŸ† {verified: true, verifiedAt: timestamp}
            CACHE-->>-VC: âœ… Updated
            VC-->>API: ğŸ‰ VerificationComplete{sessionId, phoneNumber}
        else âŒ Code Invalid
            RSC-->>VC: âŒ InvalidCodeException(attemptsRemaining: 2)
            VC-->>API: âš ï¸ HTTP 422 Invalid Code
        else ğŸš« Too Many Attempts
            RSC-->>VC: ğŸš« RateLimitedException
            VC->>CACHE: ğŸ”’ Blacklist session for 5 minutes
            VC-->>API: ğŸš« HTTP 429 Too Many Requests
        end
        
        API-->>-LB: Response based on verification result
        LB-->>-C: Verification result
    end
```